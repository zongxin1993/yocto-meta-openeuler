--- libhugetlbfs-2.23/alloc.c	2022-09-15 22:23:48.589851908 +0800
+++ libhugetlbfs-2.23/alloc.c	2022-09-15 22:23:11.770557710 +0800
@@ -245,6 +245,7 @@ void free_huge_pages(void *ptr)
 	__free_huge_pages(ptr, 1);
 }
 
+#define _SC_LEVEL2_CACHE_LINESIZE 1150
 /*
  * Offset the buffer using bytes wasted due to alignment to avoid using the
  * same cache lines for the start of every buffer returned by

--- libhugetlbfs-2.23/shm.c     2022-09-15 22:36:51.513384959 +0800
+++ libhugetlbfs-2.23/shm.c     2022-09-15 22:37:35.385733745 +0800
@@ -29,6 +29,7 @@
 #include "libhugetlbfs_internal.h"
 #include "hugetlbfs.h"
 #include <sys/syscall.h>
+#include <sys/cdefs.h>

 #if defined(SYS_shmget) || defined(SYS_ipc)
 #define HAVE_SHMGET_SYSCALL

--- libhugetlbfs-2.23/tests/hugetests.h 2022-09-15 22:49:23.818330241 +0800
+++ libhugetlbfs-2.23/tests/hugetests.h 2022-09-15 22:51:06.993110645 +0800
@@ -23,6 +23,7 @@
 #include <errno.h>
 #include <string.h>
 #include <unistd.h>
+#include <sys/types.h>

 #include "libhugetlbfs_privutils.h"
 #include "libhugetlbfs_testprobes.h"

--- libhugetlbfs-2.23/tests/gethugepagesizes.c  2022-09-15 22:55:18.499012983 +0800
+++ libhugetlbfs-2.23/tests/gethugepagesizes.c  2022-09-15 22:57:51.207168038 +0800
@@ -29,6 +29,7 @@
 #include <fcntl.h>
 #include <stdarg.h>
 #include <hugetlbfs.h>
+#include <limits.h>

 #include "hugetests.h"
